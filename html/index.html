<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paste Inspector</title>
    <script src="https://unpkg.com/prettier@3.0.0/standalone.js"></script>
    <script src="https://unpkg.com/prettier@3.0.0/plugins/html.js"></script>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
          sans-serif;
        padding: 2rem;
      }

      #drop {
        min-height: 200px;
        max-height: 50vh;
        overflow: auto;
        width: 600px;
        border: 2px solid #f0f0f0;
        border-radius: 3px;
      }

      ul {
        padding: 0;
      }

      li {
        display: block;
        margin-bottom: 1rem;
      }

      h2 {
        font-size: 1rem;
      }

      pre {
        background-color: #f0f0f0;
        font-size: 0.8rem;
        padding: 2rem;
        font-family: monospace;
        overflow: auto;
        max-height: 60px;
        max-width: 600px;
        border-radius: 3px;
      }
      section {
        max-width: 75vw;
        margin: 0 auto;
      }
      .imgbox {
        display: flex;
        justify-content: center;
        padding: 1rem;
        background-color: #f0f0f0;
      }
    </style>
  </head>
  <body>
    <section>
      <h1>Paste Inspector</h1>
      <p>
        paste something into the textarea below to inspect the Clipboard
        contents.
      </p>
      <textarea id="drop"></textarea>

      <ul id="result"></ul>
      <script>
        const dropzone = document.getElementById("drop");
        const result = document.getElementById("result");

        const renderFile = (file, type) => {
          const container = document.createElement("li");

          const heading = document.createElement("h2");
          heading.innerText = `File type: ${type}`;
          const content = file;

          container.appendChild(heading);
          container.appendChild(content);
          result.appendChild(container);
        };

        const renderResult = ({ type, data }) => {
          const container = document.createElement("li");

          const heading = document.createElement("h2");
          heading.innerText = type;

          const content = document.createElement("pre");
          let secondary;

          if (type === "text/html") {
            prettier
              .format(data, {
                parser: "html",
                plugins: prettierPlugins,
              })
              .then((result) => {
                content.innerText = result;
              });
            secondary = document.createElement("div");
            secondary.innerHTML = data;
          } else {
            content.innerText = data;
          }

          container.appendChild(heading);
          container.appendChild(content);
          if (secondary) {
            container.appendChild(secondary);
          }

          result.appendChild(container);
        };

        const handlePaste = (evt) => {
          const { clipboardData } = evt;
          result.innerHTML = "";
          dropzone.innerHTML = "";

          const mimeTypesToCheck = clipboardData.types;

          console.log("items", clipboardData.items);
          for (const item of evt.clipboardData.items) {
            console.log(`kind = ${item.kind}, type = ${item.type}`);
            if (item.kind === "file") {
              if (item.type.indexOf("image/") !== -1) {
                const blob = item.getAsFile();
                const url = URL.createObjectURL(blob);
                const img = document.createElement("img");
                img.src = url;
                const imgbox = document.createElement("div");
                imgbox.classList.add("imgbox");
                imgbox.appendChild(img);
                renderFile(imgbox, item.type);
              } else {
                const blob = item.getAsFile();
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.innerText = blob.name;
                renderFile(a, item.type);
              }
            } else {
              console.log(item.type);
              const data = clipboardData.getData(item.type);
              if (data) {
                renderResult({ type: item.type, data });
              }
            }
          }
        };

        dropzone.addEventListener("paste", handlePaste);
      </script>
    </section>
  </body>
</html>
